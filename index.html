<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Urban Resolve - Citizen Engagement System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics-compat.js"></script>
  
  <!-- Configuration -->
  <script type="module" src="js/config.js"></script>
  
  <!-- Initialize Firebase -->
  <script type="module">
    import config from './js/config.js';
    
    try {
    // Initialize Firebase
      firebase.initializeApp(config.firebase);
    
    // Initialize Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    const analytics = firebase.analytics();
      
      // Enable offline persistence
      db.enablePersistence()
        .catch((err) => {
          if (err.code === 'failed-precondition') {
            console.warn('Multiple tabs open, persistence can only be enabled in one tab at a time.');
          } else if (err.code === 'unimplemented') {
            console.warn('The current browser does not support persistence.');
          }
        });
      
      // Export Firebase services
      window.firebaseServices = {
        auth,
        db,
        storage,
        analytics
      };
      
      // Log successful initialization
      console.log('Firebase initialized successfully');
    } catch (error) {
      console.error('Error initializing Firebase:', error);
      // Show user-friendly error message
      document.body.innerHTML = `
        <div style="text-align: center; padding: 2rem;">
          <h1>Error Initializing Application</h1>
          <p>We're sorry, but there was an error initializing the application. Please try refreshing the page or contact support if the problem persists.</p>
        </div>
      `;
    }
  </script>
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #1e40af;
      --background-color: #f3f4f6;
      --text-color: #1f2937;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: var(--background-color);
      color: var(--text-color);
    }

    header {
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 1rem 2rem;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--primary-color);
      font-size: 1.75rem;
      font-weight: bold;
      text-decoration: none;
      padding: 0.5rem 0;
    }

    .logo i {
      font-size: 1.75rem;
    }

    .logo:hover {
      opacity: 0.9;
    }

    nav {
      display: flex;
      gap: 1.5rem;
    }

    nav a {
      color: var(--text-color);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.3s;
    }

    nav a:hover {
      color: var(--primary-color);
    }

    main {
      max-width: 1200px;
      margin: 6rem auto 2rem;
      padding: 0 2rem;
    }

    .hero {
      text-align: center;
      padding: 3rem 0;
      background: linear-gradient(to right, #2563eb11, #1e40af11);
      border-radius: 1rem;
      margin-bottom: 2rem;
    }

    .hero h1 {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }

    .card {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    .login-container {
      max-width: 400px;
      margin: 0 auto;
    }

    .form-group {
      position: relative;
      margin-bottom: 1.5rem;
      width: 100%;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-color);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color, #e5e7eb);
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: all 0.2s;
      font-family: inherit;
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.5;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #9ca3af;
    }

    .form-group input[type="password"],
    .form-group input[type="text"] {  /* Apply to both password and text modes */
      padding-right: 2.5rem;
      width: 100%;
      box-sizing: border-box;
    }

    .password-toggle {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(calc(-50% + 12px)); /* Adjust for label height */
      background: none;
      border: none;
      cursor: pointer;
      color: #666;
      padding: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
      z-index: 2;
      width: auto; /* Ensure button doesn't affect input width */
    }

    .password-toggle:hover {
      color: var(--primary-color);
    }

    .password-toggle i {
      font-size: 1.1rem;
      line-height: 1;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: var(--secondary-color);
    }

    .complaint-card {
      background: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .status-submitted { background-color: #fef3c7; color: #92400e; }
    .status-progress { background-color: #dbeafe; color: #1e40af; }
    .status-resolved { background-color: #dcfce7; color: #166534; }

    .admin-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .admin-buttons button {
      flex: 1;
    }

    .auth-links {
      text-align: center;
      margin-top: 1rem;
    }

    .auth-links a {
      color: var(--primary-color);
      text-decoration: none;
      margin: 0 1rem;
    }

    .auth-links a:hover {
      text-decoration: underline;
    }

    .file-upload {
      border: 2px dashed #e5e7eb;
      padding: 1.5rem;
      text-align: center;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    .file-upload:hover {
      border-color: var(--primary-color);
    }

    @media (max-width: 768px) {
      nav {
        display: none;
      }
      .form-row {
        flex-direction: column;
      }
    }

    /* Mobile menu styles */
    .mobile-menu-button {
      display: none;  /* Hidden by default on desktop */
      background: none;
      border: none;
      padding: 0.75rem;
      margin-right: 0.5rem;
      color: var(--text-color);
      cursor: pointer;
      font-size: 1.25rem;
      width: 45px;
      height: 45px;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
    }

    .mobile-menu-button:active {
      background-color: #f3f4f6;
    }

    .mobile-menu-button:hover {
      color: var(--primary-color);
    }

    .mobile-menu {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: white;
      z-index: 2000;
      padding: 1rem;
      animation: slideInRight 0.3s ease-out;
    }

    .mobile-menu.show {
      display: block;
    }

    .mobile-menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .mobile-menu-close {
      background: none;
      border: none;
      padding: 0.5rem;
      color: var(--text-color);
      cursor: pointer;
      font-size: 1.25rem;
    }

    .mobile-menu nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .mobile-menu nav a {
      padding: 1rem;
      border-radius: 0.5rem;
      transition: background-color 0.2s;
    }

    .mobile-menu nav a:hover {
      background-color: #f3f4f6;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @media (max-width: 768px) {
      .mobile-menu-button {
        display: flex;
      }

      nav {
        display: none;
      }

      .header-content {
        padding: 0.5rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
      }

      .logo {
        font-size: 1.25rem;
      }

      .form-row {
        flex-direction: column;
      }

      .user-dropdown-content {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        border-radius: 1rem 1rem 0 0;
        animation: slideInUp 0.3s ease-out;
      }
    }

    @keyframes slideInUp {
      from {
        transform: translateY(100%);
      }
      to {
        transform: translateY(0);
      }
    }

    .notification {
      position: fixed;
      top: 5rem;
      right: 1rem;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      background: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: slideIn 0.3s ease-out;
      max-width: 24rem;
    }

    .notification.success {
      border-left: 4px solid var(--success-color);
    }

    .notification.error {
      border-left: 4px solid var(--error-color);
    }

    .notification.warning {
      border-left: 4px solid var(--warning-color);
    }

    .notification i {
      font-size: 1.25rem;
    }

    .notification.success i {
      color: var(--success-color);
    }

    .notification.error i {
      color: var(--error-color);
    }

    .notification.warning i {
      color: var(--warning-color);
    }

    .notification-content {
      flex: 1;
    }

    .notification h4 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }

    .notification p {
      margin: 0.25rem 0 0 0;
      font-size: 0.875rem;
      color: #6b7280;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    .notification.hiding {
      animation: slideOut 0.3s ease-in forwards;
    }

    /* User dropdown menu styles */
    .user-dropdown {
      position: relative;
      display: inline-block;
    }

    .user-dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background-color: white;
      min-width: 180px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border-radius: 0.5rem;
      padding: 0.5rem 0;
      z-index: 1000;
    }

    .user-dropdown-content.show {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }

    .user-dropdown-content a {
      color: var(--text-color);
      padding: 0.75rem 1rem;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.2s;
    }

    .user-dropdown-content a:hover {
      background-color: #f3f4f6;
      color: var(--primary-color);
    }

    .user-dropdown-content .divider {
      height: 1px;
      background-color: #e5e7eb;
      margin: 0.5rem 0;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Add admin dashboard styles */
    .admin-dashboard {
      display: none;
      padding: 2rem;
    }

    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }

    .stat-card i {
      font-size: 2rem;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .stat-card h3 {
      margin: 0.5rem 0;
      color: var(--text-color);
    }

    .stat-card p {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary-color);
    }

    .admin-filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .admin-filters select {
      min-width: 200px;
    }

    .complaints-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 0.5rem;
      overflow: hidden;
    }

    .complaints-table th,
    .complaints-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    .complaints-table th {
      background: var(--primary-color);
      color: white;
    }

    .complaints-table tr:hover {
      background: #f8fafc;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .action-buttons button {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .file-upload {
      margin-bottom: 1rem;
    }

    .file-upload label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: #f3f4f6;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .file-upload label:hover {
      background-color: #e5e7eb;
    }

    .file-upload input[type="file"] {
      display: none;
    }

    .file-info {
      color: #6b7280;
      font-size: 0.875rem;
    }

    .file-preview {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .file-preview img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 0.5rem;
    }

    .file-preview .file-item {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: #f3f4f6;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <a href="/" class="logo">
        <i class="fas fa-city"></i>
        Urban Resolve
      </a>
      <nav>
        <a href="#" onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
        <a href="#" onclick="showSection('submit')"><i class="fas fa-plus-circle"></i> Submit Issue</a>
        <a href="#" onclick="showSection('status')"><i class="fas fa-tasks"></i> Check Status</a>
        <a href="#" onclick="showSection('suggestions')"><i class="fas fa-lightbulb"></i> Suggestions</a>
        <a href="#" id="loginNav" onclick="showSection('login')"><i class="fas fa-user"></i> Login</a>
      </nav>
      <button class="mobile-menu-button" onclick="toggleMobileMenu()">
        <i class="fas fa-bars fa-lg"></i>
      </button>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
      <div class="logo">
        <i class="fas fa-city"></i>
        Urban Resolve
      </div>
      <button class="mobile-menu-close" onclick="toggleMobileMenu()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <nav>
      <a href="#" onclick="showSectionMobile('home')"><i class="fas fa-home"></i> Home</a>
      <a href="#" onclick="showSectionMobile('submit')"><i class="fas fa-plus-circle"></i> Submit Issue</a>
      <a href="#" onclick="showSectionMobile('status')"><i class="fas fa-tasks"></i> Check Status</a>
      <a href="#" onclick="showSectionMobile('suggestions')"><i class="fas fa-lightbulb"></i> Suggestions</a>
      <a href="#" id="loginNavMobile" onclick="showSectionMobile('login')"><i class="fas fa-user"></i> Login</a>
    </nav>
  </div>

  <main>
    <div id="home">
      <div class="hero">
        <h1><i class="fas fa-city"></i> Welcome to Urban Resolve</h1>
        <p>Your voice matters! Report issues and help improve our community together.</p>
      </div>
      <div class="card">
        <h2><i class="fas fa-info-circle"></i> About Us</h2>
        <p>Urban Resolve is your trusted community engagement platform, empowering citizens to report concerns, share feedback, and collaborate with local authorities for better public services and community wellbeing. We're here to ensure your voice drives meaningful change. Together, we build stronger and better communities.</p>
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <div style="flex: 1; text-align: center;">
            <i class="fas fa-clock fa-2x" style="color: var(--primary-color)"></i>
            <h3>Quick Response</h3>
            <p>Get updates on your complaints within 24-48 hours</p>
          </div>
          <div style="flex: 1; text-align: center;">
            <i class="fas fa-chart-line fa-2x" style="color: var(--primary-color)"></i>
            <h3>Track Progress</h3>
            <p>Monitor the status of your complaints in real-time</p>
          </div>
          <div style="flex: 1; text-align: center;">
            <i class="fas fa-hands-helping fa-2x" style="color: var(--primary-color)"></i>
            <h3>Community Impact</h3>
            <p>Join others in making our community better</p>
          </div>
        </div>
      </div>
    </div>

    <div id="login" style="display:none;">
      <div class="login-container card">
        <h2><i class="fas fa-user"></i> User Login</h2>
        <div class="form-group">
          <label for="loginEmail">Email Address</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" />
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" />
          <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <button onclick="loginUser()">Login</button>
        <div class="auth-links">
          <p style="margin: 1rem 0;">Don't have an account? <a href="#" onclick="showUserSignup()">Sign up</a></p>
          <a href="#" onclick="showSection('forgot-password')">Forgot Password?</a>
        </div>
      </div>
    </div>

    <div id="signup" style="display:none;">
      <div class="login-container card">
        <h2 id="signupTitle"><i class="fas fa-user-plus"></i> Create Account</h2>
        <div id="adminFields" style="display: none;">
          <div class="form-group">
            <label>Department</label>
            <select id="adminDepartment" required>
              <option value="">Select Department</option>
              <option value="water">Water Department</option>
              <option value="electricity">Electricity Department</option>
              <option value="roads">Roads & Transportation</option>
              <option value="waste">Waste Management</option>
              <option value="sanitation">Sanitation Department</option>
              <option value="healthcare">Healthcare Department</option>
              <option value="education">Education Department</option>
              <option value="safety">Public Safety Department</option>
            </select>
          </div>
          <div class="form-group">
            <label>Position</label>
            <input type="text" id="adminPosition" placeholder="Enter your position" />
          </div>
          <div class="form-group">
            <label>Employee ID</label>
            <input type="text" id="adminEmployeeId" placeholder="Enter your employee ID" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="signupFirstName">First Name</label>
            <input type="text" id="signupFirstName" required />
          </div>
          <div class="form-group">
            <label for="signupLastName">Last Name</label>
            <input type="text" id="signupLastName" required />
          </div>
        </div>
        <div class="form-group">
          <label for="signupEmail">Email Address</label>
          <input type="email" id="signupEmail" required />
        </div>
        <div class="form-group">
          <label for="signupPhone">Phone Number</label>
          <input type="tel" id="signupPhone" required />
        </div>
        <div class="form-group">
          <label for="signupPassword">Password</label>
          <input type="password" id="signupPassword" required onkeyup="validatePassword()" />
          <small id="passwordHint" style="color: #666; display: none;">Password must be at least 6 characters long</small>
        </div>
        <div class="form-group">
          <label for="signupConfirmPassword">Confirm Password</label>
          <input type="password" id="signupConfirmPassword" required onkeyup="validatePassword()" />
          <small id="passwordMatch" style="display: none;"></small>
        </div>
        <button onclick="signupUser()">Create Account</button>
        <div class="auth-links">
          <a href="#" id="backToLogin" onclick="showSection('login')">Already have an account? Login</a>
        </div>
      </div>
    </div>

    <div id="forgot-password" style="display:none;">
      <div class="login-container card">
        <h2><i class="fas fa-key"></i> Reset Password</h2>
        <p>Enter your email address and we'll send you instructions to reset your password.</p>
        <div class="form-group">
          <label for="resetEmail">Email Address</label>
          <input type="email" id="resetEmail" placeholder="Enter your email" />
        </div>
        <button onclick="resetPassword()">Send Reset Link</button>
        <div class="auth-links">
          <a href="#" onclick="showSection('login')">Back to Login</a>
        </div>
      </div>
    </div>

    <div id="admin-login" style="display:none;">
      <div class="login-container card">
        <h2><i class="fas fa-lock"></i> Admin Portal</h2>
        <div class="form-group">
          <label for="adminEmail">Admin Email</label>
          <input type="email" id="adminEmail" placeholder="Enter admin email" />
        </div>
        <div class="form-group">
          <label for="adminPassword">Password</label>
          <input type="password" id="adminPassword" placeholder="Enter admin password" />
          <button type="button" class="password-toggle" onclick="togglePassword('adminPassword')">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <button onclick="loginAdmin()">Login</button>
        <div class="auth-links">
          <p style="margin: 1rem 0;">Don't have an account? <a href="#" onclick="showAdminSignup()">Sign up as Administrator</a></p>
          <a href="#" onclick="showSection('forgot-password')">Forgot Password?</a>
        </div>
      </div>
    </div>

    <div id="form-section" style="display:none;">
      <div class="card">
        <h2><i class="fas fa-edit"></i> Submit Complaint / Feedback</h2>
      <form id="complaintForm" onsubmit="submitComplaint(event)">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Full Name</label>
              <input type="text" id="name" required />
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="category">Category</label>
              <select id="category" required>
                <option value="">Select a category</option>
                <option value="water"><i class="fas fa-water"></i> Water Supply</option>
                <option value="electricity"><i class="fas fa-bolt"></i> Electricity</option>
                <option value="roads"><i class="fas fa-road"></i> Roads & Transportation</option>
                <option value="waste"><i class="fas fa-trash"></i> Waste Management</option>
                <option value="sanitation"><i class="fas fa-broom"></i> Sanitation</option>
                <option value="healthcare"><i class="fas fa-hospital"></i> Healthcare</option>
                <option value="education"><i class="fas fa-school"></i> Education</option>
                <option value="safety"><i class="fas fa-shield-alt"></i> Public Safety</option>
                <option value="other"><i class="fas fa-question-circle"></i> Other</option>
        </select>
            </div>
            <div class="form-group">
              <label for="location">Location</label>
              <input type="text" id="location" placeholder="Enter address or area" required />
            </div>
          </div>
          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" rows="4" placeholder="Please provide detailed information about the issue..." required></textarea>
          </div>
          <div class="form-group file-upload">
            <label for="fileInput">
              <i class="fas fa-cloud-upload-alt"></i> Upload Files
              <span class="file-info">(Photos and documents)</span>
            </label>
            <input type="file" id="fileInput" multiple accept="image/*,.pdf,.doc,.docx">
            <div class="file-preview"></div>
          </div>
          <button type="submit"><i class="fas fa-paper-plane"></i> Submit Complaint</button>
      </form>
      </div>
    </div>

    <div id="complaint-list" style="display:none;">
      <div class="card">
        <h2><i class="fas fa-clipboard-list"></i> Complaint Status Dashboard</h2>
        <p class="subtitle" style="color: #666; margin-bottom: 2rem;">Track and monitor the status of your submitted complaints</p>
        
        <div class="status-summary" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
          <div style="flex: 1; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; text-align: center;">
            <i class="fas fa-paper-plane fa-lg" style="color: var(--primary-color);"></i>
            <h4>Submitted</h4>
            <p id="submitted-count">0</p>
          </div>
          <div style="flex: 1; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; text-align: center;">
            <i class="fas fa-clock fa-lg" style="color: var(--warning-color);"></i>
            <h4>In Progress</h4>
            <p id="progress-count">0</p>
          </div>
          <div style="flex: 1; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; text-align: center;">
            <i class="fas fa-check-circle fa-lg" style="color: var(--success-color);"></i>
            <h4>Resolved</h4>
            <p id="resolved-count">0</p>
          </div>
        </div>

        <h3 style="margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">
          <i class="fas fa-list"></i> Your Complaints
        </h3>
        
        <div id="no-complaints-message" style="display: none;">
          <div style="text-align: center; padding: 2rem; background: #f8fafc; border-radius: 0.5rem;">
            <i class="fas fa-inbox fa-3x" style="color: var(--primary-color); margin-bottom: 1rem;"></i>
            <h3 style="color: #374151; margin-bottom: 0.5rem;">No Complaints Yet</h3>
            <p style="color: #6b7280; margin-bottom: 1.5rem;">You haven't submitted any complaints yet. When you do, they will appear here with their current status.</p>
            <button onclick="showSection('submit')" style="margin-top: 1rem;">
              <i class="fas fa-plus-circle"></i> Submit New Complaint
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="suggestions" style="display:none;">
      <div class="card">
        <h2><i class="fas fa-lightbulb"></i> Community Suggestions</h2>
        <p>Share your ideas to improve our community! Your suggestions help make our city better.</p>
        <form id="suggestionForm">
          <div class="form-group">
            <label for="suggestionTitle">Title</label>
            <input type="text" id="suggestionTitle" placeholder="Brief title for your suggestion" required />
          </div>
          <div class="form-group">
            <label for="suggestionCategory">Category</label>
            <select id="suggestionCategory" required>
              <option value="">Select a category</option>
              <option value="infrastructure">Infrastructure</option>
              <option value="environment">Environment</option>
              <option value="community">Community Services</option>
              <option value="safety">Public Safety</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="suggestionDescription">Description</label>
            <textarea id="suggestionDescription" rows="4" placeholder="Describe your suggestion in detail..." required></textarea>
          </div>
          <button type="submit"><i class="fas fa-paper-plane"></i> Submit Suggestion</button>
        </form>
      </div>
      <div id="suggestions-list" class="card">
        <h3>Recent Suggestions</h3>
        <!-- Suggestions will be displayed here -->
      </div>
    </div>

    <div id="admin-dashboard" class="admin-dashboard">
      <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
      
      <div class="admin-stats">
        <div class="stat-card">
          <i class="fas fa-inbox"></i>
          <h3>New Complaints</h3>
          <p id="new-complaints-count">0</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-clock"></i>
          <h3>In Progress</h3>
          <p id="in-progress-count">0</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-check-circle"></i>
          <h3>Resolved</h3>
          <p id="resolved-complaints-count">0</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-chart-line"></i>
          <h3>Response Rate</h3>
          <p id="response-rate">0%</p>
        </div>
      </div>

      <div class="admin-filters">
        <select id="department-filter" onchange="filterComplaints()">
          <option value="">All Departments</option>
          <option value="water">Water Department</option>
          <option value="electricity">Electricity Department</option>
          <option value="roads">Roads & Transportation</option>
          <option value="waste">Waste Management</option>
          <option value="sanitation">Sanitation</option>
          <option value="healthcare">Healthcare</option>
          <option value="education">Education</option>
          <option value="safety">Public Safety</option>
        </select>
        <select id="status-filter" onchange="filterComplaints()">
          <option value="">All Status</option>
          <option value="Submitted">New</option>
          <option value="In Progress">In Progress</option>
          <option value="Resolved">Resolved</option>
        </select>
        <input type="date" id="date-filter" onchange="filterComplaints()">
      </div>

      <div class="card">
        <table class="complaints-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Date</th>
              <th>Category</th>
              <th>Description</th>
              <th>Location</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="complaints-table-body">
            <!-- Complaints will be populated here -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Global user/session variables
    let currentUserEmail = '';
    let currentUserName = '';
    let currentUserRole = '';
    let adminMode = false;

    document.addEventListener('DOMContentLoaded', function() {
      // Navigation event handlers
      const navLinks = document.querySelectorAll('nav a');
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const section = this.getAttribute('onclick').match(/'([^']+)'/)[1];
          showSection(section);
        });
      });

      // Mobile menu navigation
      const mobileNavLinks = document.querySelectorAll('#mobileMenu nav a');
      mobileNavLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const section = this.getAttribute('onclick').match(/'([^']+)'/)[1];
          showSection(section);
          document.getElementById('mobileMenu').classList.remove('show');
        });
      });

      // Logo click
      var logo = document.querySelector('.logo');
      if (logo) {
        logo.addEventListener('click', function(e) {
      e.preventDefault();
      showSection('home');
        });
      }

      // Attach form event handlers
      var complaintForm = document.getElementById('complaintForm');
      if (complaintForm) complaintForm.addEventListener('submit', submitComplaint);
      var suggestionForm = document.getElementById('suggestionForm');
      if (suggestionForm) suggestionForm.addEventListener('submit', submitSuggestion);
      var signupBtn = document.querySelector('#signup button');
      if (signupBtn) signupBtn.addEventListener('click', signupUser);
      var loginBtn = document.querySelector('#login button');
      if (loginBtn) loginBtn.addEventListener('click', loginUser);
      var resetBtn = document.querySelector('#forgot-password button');
      if (resetBtn) resetBtn.addEventListener('click', resetPassword);
    });

    function showSection(id) {
      // Hide all sections first
      const sections = ['home', 'submit', 'status', 'login', 'signup', 'suggestions', 'complaint-list'];
      sections.forEach(section => {
        const element = document.getElementById(section);
        if (element) {
          element.style.display = 'none';
        }
      });

      // Special handling for submit and status sections
      if (id === 'submit') {
        if (!currentUserEmail) {
          // Show login prompt if not logged in
          document.getElementById('form-section').innerHTML = `
            <div class="card">
              <h2><i class="fas fa-user-lock"></i> Login Required</h2>
              <p>Please login to submit a complaint.</p>
              <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button onclick="showSection('login')" style="background-color: var(--primary-color);">
                  <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button onclick="showSection('signup')" style="background-color: var(--secondary-color);">
                  <i class="fas fa-user-plus"></i> Create Account
                </button>
              </div>
            </div>
          `;
          document.getElementById('form-section').style.display = 'block';
        } else {
          document.getElementById('form-section').style.display = 'block';
        }
      } else if (id === 'status') {
        if (!currentUserEmail) {
          // Show login prompt if not logged in
          document.getElementById('complaint-list').innerHTML = `
            <div class="card">
              <h2><i class="fas fa-user-lock"></i> Login Required</h2>
              <p>Please login to view your complaints.</p>
              <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button onclick="showSection('login')" style="background-color: var(--primary-color);">
                  <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button onclick="showSection('signup')" style="background-color: var(--secondary-color);">
                  <i class="fas fa-user-plus"></i> Create Account
                </button>
              </div>
            </div>
          `;
          document.getElementById('complaint-list').style.display = 'block';
        } else {
          document.getElementById('complaint-list').style.display = 'block';
          renderComplaints();
        }
      } else {
        const section = document.getElementById(id);
        if (section) {
          section.style.display = 'block';
        }
      }

      // Update URL for admin routes
      if (id === 'admin-login' || id === 'admin-dashboard') {
        window.history.pushState({}, '', '/admin');
      }
    }

    // Ensure showSection and all navigation functions are globally available
    window.showSection = showSection;
    window.showUserSignup = showUserSignup;
    window.showAdminSignup = showAdminSignup;
    window.toggleMobileMenu = toggleMobileMenu;

    async function signupUser() {
      if (!window.firebaseServices) {
        showNotification('error', 'App Error', 'Firebase is not initialized. Please refresh the page.');
        return;
      }
      const auth = window.firebaseServices.auth;
      const db = window.firebaseServices.db;

      const firstName = document.getElementById("signupFirstName").value;
      const lastName = document.getElementById("signupLastName").value;
      const email = document.getElementById("signupEmail").value;
      const password = document.getElementById("signupPassword").value;
      const confirmPassword = document.getElementById("signupConfirmPassword").value;
      const phone = document.getElementById("signupPhone").value;
      
      // Password validation
      if (!password || !confirmPassword) {
        showNotification('error', 'Missing Password', "Please fill in both password fields.");
        return;
      }

      if (password.length < 6) {
        showNotification('error', 'Invalid Password', "Password must be at least 6 characters long.");
        return;
      }

      if (password !== confirmPassword) {
        showNotification('error', 'Password Mismatch', "Passwords don't match. Please try again.");
        // Clear password fields
        document.getElementById("signupPassword").value = '';
        document.getElementById("signupConfirmPassword").value = '';
        return;
      }

      try {
        // Create user with email and password
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Update user profile
        await user.updateProfile({
          displayName: `${firstName} ${lastName}`
        });

        // Store additional user data in Firestore
        await db.collection('users').doc(user.uid).set({
          name: `${firstName} ${lastName}`,
          email: email,
          phone: phone,
          role: 'user',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Set current user
        currentUserEmail = email;
        currentUserName = `${firstName} ${lastName}`;
        currentUserRole = 'user';
        adminMode = false;

        // Update navigation and show success message
        updateNavigation();
        showSection('home');
        showNotification('success', 'Account Created', 'Your account has been created successfully!');
      } catch (error) {
        console.error('Registration error:', error);
        showNotification('error', 'Registration Failed', error.message);
      }
    }
  </script>
</body>
</html>
